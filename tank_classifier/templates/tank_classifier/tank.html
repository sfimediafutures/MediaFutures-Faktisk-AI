{% extends "tank_classifier/base.html" %}
{% load static %}
{% load django_bootstrap5 %}

{% block title %}Tank Classifier{% endblock %}

{% block content %}

        <div class="container px-5 text-center vh-100">
            <div class="row justify-content-center align-items-center">
                <div class="col-12 py-5">
                    <h1 class="display-1">Tank Classifier</h1>
                </div>
            </div>
            <div class="row justify-content-center align-items-center pb-5">
                <div class="col-auto">
                    <p class="fs-4">This system uses deep learning to classify tanks and artillery vehicles.</p>
                    <p class="fs-4 pb-3">For instructions, click the button below to open up the tutorial</p>
                <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#tutorial">
                    Tutorial
                </button>
                </div>
            </div>
            <div class="row align-items-center justify-content-center">
                <div class="col-auto">
                    <p class="fs-4">Select an image containing a tank using the input below</p>
                </div>
            </div>
            <div class="row align-items-center justify-content-center">
                <div class="col-auto">
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        {% bootstrap_form form size='lg' %}
                        <div class="invalid-feedback">
                        Please choose a valid file.</div>
                        {% bootstrap_button button_type="submit" content='Classify' button_class='btn-light' size='lg' %}
                    </form>
                </div>
            </div>

        {% if image_uri is not None %}
            <div class="row mt-5" id="results">
                <div class="col-auto">
                    <h2 class="display-5">Results:</h2>
                </div>

            </div>
        <div class="row mt-5">
                <div class="col-md">
                    <img src="{{ image_uri }}" class="img-fluid" alt="Uploaded image"
                     style="max-width: min(600px, 100%); height: auto; margin-top: 10px;">
                </div>
            {% endif %}
            <div class="col-md">
                {% if image_uri is not None %}
                    <h3><b>The AI thinks this is: </b></h3>
                    <br>
                    {% for key in predictions %}
                      <strong><h5>{{ key.0 }}</h5></strong>
                      <div class="progress mb-4">
                        <div id="dynamic" class="bar progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: {{ key.1 }}%; color: black;"><strong>{{ key.1 }}%</strong></div>
                      </div>
                    {% endfor %}
                {% endif %}

            </div>
        </div>
        <div class="row mt-5">
          {% if image_uri is not None %}
            <h3><b>More information</b></h3>
            <table class="table">
              <thead class="thead-dark">
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Year in service</th>
                  <th scope="col">Origin</th>
                  <th scope="col">Number built</th>
                  <th scope="col">Notes</th>
                </tr>
              </thead>
              <tbody>
                {% for key, value in dictionary.items %}
                    <tr>
                      <th scope="row">1</th>
                      <td><p>{{ value.Name }}</p></td>
                      <td><p>{{ value.Yearinservice }}</p></td>
                      <td><p>{{ value.Origin }}</p></td>
                      <td><p>{{ value.Numberbuilt   }}</p></td>
                      <td><p style="text-align: justify;">{{ value.Notes }}</p></td>
                    </tr>
                {% endfor %}
              </tbody>
            </table>
            {% endif %}
        </div>

        {% if image_uri is not None %}
        <!-- Gallery -->
        <div class="row">
          <h3><b>More pictures for comparison</b></h3>
          <div class="col-lg-4 col-md-12 mb-4 mb-lg-0">
            {% for key, value in dictionary.items %}
              <a href="{% static '' %}{{value.Name}}/1.jpg" target="blank"><img
                src="{% static '' %}{{value.Name}}/1.jpg"
                class="w-100 shadow-1-strong rounded mb-4"
                alt="Uploaded image"
              /></a>
            {% endfor %}
          </div>

          <div class="col-lg-4 mb-4 mb-lg-0">

            {% for key, value in dictionary.items %}
              <a href="{% static '' %}{{value.Name}}/2.jpg" target="blank"><img
                src="{% static '' %}{{value.Name}}/2.jpg"
                class="w-100 shadow-1-strong rounded mb-4"
                alt="Uploaded image"
              /></a>
            {% endfor %}
          </div>

          <div class="col-lg-4 mb-4 mb-lg-0">
            {% for key, value in dictionary.items %}
              <a href="{% static '' %}{{value.Name}}/3.jpg" target="blank"><img
                src="{% static '' %}{{value.Name}}/3.jpg"
                class="w-100 shadow-1-strong rounded mb-4"
                alt="Uploaded image"
              /></a>
            {% endfor %}
          </div>
        </div>
        <!-- Gallery -->
        {% endif %}
    </div>

    {% if anchor is not None %}
        <script type='text/javascript'>
            $(document).ready(function(){
            window.location = '#{{ anchor }}'
            });
        </script>
    {% endif %}

<div class="modal fade" id="tutorial" tabindex="-1">
  <div class="modal-dialog modal-xl modal-fullscreen-lg-down">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Tank Classifier Tutorial</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

          <div class="container" style="margin-top: 80px;">
      <h3>Tank Classifier Tutorial</h3>
      <p style="text-align: justify;">
        We have created a user-friendly tutorial to help users effectively utilize the AI-based tank classification model. The interface is easy to navigate, users can upload an image of a military vehicle, such as a main battle tank or artillery vehicle, by clicking the "Choose File" button. After selecting the image, the user can run the classification by clicking the "Classify" button, and the model will display the predictions as illustrated in the image below.</p>

        <img style="width: 600px;" class="img-fluid rounded-2 my-3" src="{% static 'tutorial_images/1.png' %}" alt="...">
        <br>
        Upon analyzing an image, the tank classifier presents the user with a list of the 5 most likely variants, ranked by probability, with the highest score being the most probable match for the image; details about the predicted military vehicle; and additional images for comparison to help the user make a more informed decision, as the AI model may not always make the correct prediction.
        <br>
        <br>
        <p style="text-align: justify;">It is important to note that the AI model will perform more accurately if the image is cropped to only include the specific vehicle being classified.
          <br>
          <br>
          For example, look at the example image below,
          <br>
          <img style="width: 600px;" class="img-fluid rounded-2 my-3" src="{% static 'tutorial_images/2.jpg' %}" alt="...">
          <br>
          If the image provided by the user shows a tank that is at a distance and partially obscured by the background/foreground elements, the AI model is likely to make an incorrect classification, as demonstrated in the example below.
          <br>
          <img style="width: 600px;" class="img-fluid rounded-2 my-3" src="{% static 'tutorial_images/3.png' %}" alt="...">
          <br>
          The image shows a T-55 tank, but the model incorrectly identifies it as a K2 Black Panther. However, when the image is cropped and the AI model is re-run, it correctly classifies the tank as a T-55.
        <br>
        <img style="width: 600px;" class="img-fluid rounded-2 my-3" src="{% static 'tutorial_images/5.png' %}" alt="...">

        <br>
        Additionally, the AI model was trained using only images of pristine tanks, meaning the tanks in the images were not damaged. However, the model still has a good ability to classify destroyed tanks correctly in most cases. Please see the 2 images below.
        <br>
        <img style="width: 600px;" class="img-fluid rounded-2 my-3" src="{% static 'tutorial_images/6.png' %}" alt="...">
        <br>
        <img style="width: 600px;" class="img-fluid rounded-2 my-3" src="{% static 'tutorial_images/9.png' %}" alt="...">
        <br>
        Even though the images contain destroyed tanks, the AI model still correctly classifies in both instances.
      </p>

        <br>
        <br>
        <p style="text-align: justify;"> <strong> Please note that this model only works for the following 20 classes of the military vehicles (18 main battle
          tanks, and 2 artillery vehicles). </p> </strong>
          <p style="text-align: justify;">['Al Khalid', 'Arjun', 'Armata', 'Challenger 2', 'K2 Black Panther', 'K9 Thunder', 'Leclerc',
            'Leopard 2', 'M109', 'M1A2 Abrams', 'Merkava Mk.4', 'Oplot-M', 'T-55', 'T-72', 'T-80', 'T-90',
            'Type 74', 'Type 90', 'Type 99', 'VT-4']</p>
            <br>
            <p style="text-align: justify;"> <strong> The training dataset is not large as well i.e., only around 110 images
            were used for each of the category to train the models. If the model is trained using more data, it
          will become more better at classifying.</p> </strong>
          <br>
    </div>



      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}